# Nix Darwin Kickstarter - Minimal

 A basic configuration comprising essential settings for initiating nix-darwin. It can be safely deployed to your system.

## How to Use

1. Install Nix package manager via [Nix Official](https://nixos.org/download.html#nix-install-macos) or [DeterminateSystems/nix-installer](https://github.com/DeterminateSystems/nix-installer).
2. Read all the files in this `minimal` folder, and understand what they do.
   1. If you have trouble understanding, [ryan4yin/nixos-and-flakes-book](https://github.com/ryan4yin/nixos-and-flakes-book) is a good resource to learn nix and flakes.
3. Install Homebrew, see <https://brew.sh/>
   1. Homebrew is required to install most of the GUI apps, App Store's apps, and some CLI apps that are not available in nix's package repository `nixpkgs`.
4. Search `TODO` in this `minimal` folder, and complete all the TODOs.
5. Run the following command in the root of your nix configuration to start your nix-darwin journey(please change `hostname` to your hostname):
   ```bash
	nix build .#darwinConfigurations.hostname.system \
		--extra-experimental-features 'nix-command flakes'

	./result/sw/bin/darwin-rebuild switch --flake .#hostname
   ```

To simplify the command, adding the following content by create a `Makefile` in the root of your nix configuration:

```makefile
# please change 'hostname' to your hostname
deploy:
	nix build .#darwinConfigurations.hostname.system \
	   --extra-experimental-features 'nix-command flakes'

	./result/sw/bin/darwin-rebuild switch --flake .#hostname
```

Then you can run `make deploy` in the root of your nix configuration to deploy your configuration.

## Configuration Structure

Your current nix-darwin configuration's structure should be as follows:

```bash
› tree
.
├── flake.lock  # a lock file generated by nix, you can ignore it for now
├── flake.nix   # the entry point of your nix configuration, you need to add your hostname here
├── modules     # a folder contains all your nix-darwin configuration files
│   ├── apps.nix        # contains all your homebrew & nix apps(both GUI & CLI)
│   ├── host-users.nix  # defines your hostname & all your system users
│   ├── nix-core.nix    # nix's core configuration, you can ignore it for now
│   └── system.nix      # defines your macOS's system configuration(like dock, trackpad, keyboard, finder, loginwindow, etc.)
├── home           # Home Manager configuration for user-level settings
│   ├── default.nix    # Home Manager entry point
│   ├── shell.nix      # shell configuration
│   ├── git.nix        # git configuration with gitalias
│   ├── gh.nix         # GitHub CLI configuration with awesome-gh-aliases
│   └── ...other modules...
└── README.md
```

## Git Aliases (Gitalias)

This configuration includes [gitalias](https://github.com/ruchirajkarki/gitalias) - a collection of 170+ mnemonic git aliases derived from command names. The aliases follow a pattern where short sequences represent full git commands.

### Complete Git Aliases Reference

**add** (5 aliases)
- `a` = add
- `aa` = add --all
- `ai` = add --interactive
- `ap` = add --patch
- `au` = add --update

**branch** (15 aliases)
- `b` = branch
- `ba` = branch --all
- `bav` = branch --all --verbose
- `bavv` = branch --all -vv
- `bc` = branch --copy
- `bd` = branch --delete
- `bdd` = branch -D
- `bdf` = branch --delete --force
- `bm` = branch --move
- `bmm` = branch -M
- `br` = branch --remotes
- `brv` = branch --remotes --verbose
- `buu` = branch --unset-upstream
- `bv` = branch --verbose
- `bvv` = branch -vv

**commit** (4 aliases)
- `c` = commit
- `ca` = commit --all
- `cam` = commit --all --message
- `cm` = commit --message

**diff** (6 aliases)
- `d` = diff
- `dc` = diff --cached
- `dfi` = diff --full-index
- `dno` = diff --name-only
- `dns` = diff --name-status
- `ds` = diff --stat

**rebase** (7 aliases)
- `e` = rebase
- `ea` = rebase --abort
- `ec` = rebase --continue
- `ei` = rebase --interactive
- `em` = rebase main
- `eo` = rebase --onto
- `es` = rebase --skip

**fetch** (3 aliases)
- `f` = fetch
- `fa` = fetch --all
- `ft` = fetch --tags

**log** (12 aliases)
- `g` = log
- `ga` = log --all
- `gag` = log --all --grep
- `gf` = log --follow
- `gg` = log --grep
- `gmc` = log --max-count
- `go` = log --oneline
- `gop` = log --oneline --patch
- `gopmc` = log --oneline --patch --max-count
- `gp` = log --patch
- `gpmc` = log --patch --max-count
- `gs` = log --stat

**stash** (7 aliases)
- `h` = stash
- `ha` = stash apply
- `hc` = stash clear
- `hd` = stash drop
- `hl` = stash list
- `hp` = stash pop
- `hs` = stash show

**config** (6 aliases)
- `i` = config
- `ie` = config --edit
- `ig` = config --global
- `ieg` = config --edit --global
- `il` = config --list
- `is` = config --system

**clone** (4 aliases)
- `k` = clone
- `kb` = clone --branch
- `kd` = clone --depth
- `krs` = clone --recurse-submodules

**pull** (8 aliases)
- `l` = pull
- `la` = pull --all
- `ld` = pull --depth
- `ldr` = pull --dry-run
- `lnt` = pull --no-tags
- `lp` = pull --prune
- `lq` = pull --quiet
- `lr` = pull --rebase
- `lv` = pull --verbose

**merge** (7 aliases)
- `m` = merge
- `ma` = merge --abort
- `mc` = merge --continue
- `mm` = merge main
- `mnc` = merge --no-commit
- `mncs` = merge --no-commit --squash
- `ms` = merge --squash

**clean** (10 aliases)
- `n` = clean
- `ndr` = clean --dry-run
- `nddr` = clean -d --dry-run
- `ndf` = clean -d --force
- `nf` = clean --force
- `nfdr` = clean --force --dry-run
- `ni` = clean --interactive
- `nq` = clean --quiet
- `nx` = clean -x
- `nxdr` = clean -x --dry-run

**remote** (7 aliases)
- `o` = remote
- `ov` = remote --verbose
- `oa` = remote add
- `oao` = remote add origin
- `opo` = remote prune origin
- `opodr` = remote prune origin --dry-run
- `osh` = remote set-head

**push** (11 aliases)
- `p` = push
- `pa` = push --all
- `pasuo` = push --all --set-upstream origin
- `pd` = push --delete
- `pdo` = push --delete origin
- `pf` = push --force
- `pfwl` = push --force-with-lease
- `po` = push origin
- `pot` = push origin tag
- `psuo` = push --set-upstream origin
- `pt` = push --tags

**restore** (2 aliases)
- `r` = restore
- `rs` = restore --staged

**switch** (6 aliases)
- `s` = switch
- `sc` = switch --create
- `sdc` = switch --discard-changes
- `sf` = switch --force
- `sfc` = switch --force-create
- `sm` = switch main

**reset** (4 aliases)
- `t` = reset
- `th` = reset --hard
- `tm` = reset --mixed
- `ts` = reset --soft

**status** (4 aliases)
- `u` = status
- `uss` = status --show-stash
- `uuf` = status --untracked-files
- `uv` = status --verbose

**revert** (6 aliases)
- `v` = revert
- `va` = revert --abort
- `vc` = revert --continue
- `vnc` = revert --no-commit
- `vq` = revert --quit
- `vs` = revert --skip

**cherry-pick** (2 aliases)
- `y` = cherry-pick
- `ync` = cherry-pick --no-commit

**Custom Aliases** (5 aliases)
- `ls` = log --pretty=format:"%C(yellow)%h%Cred%d\ %Creset%s%Cblue\ [%cn]" --decorate
- `ll` = log --pretty=format:"%C(yellow)%h%Cred%d\ %Creset%s%Cblue\ [%cn]" --decorate --numstat
- `amend` = commit --amend -m
- `update` = submodule update --init --recursive
- `foreach` = submodule foreach

## GitHub CLI Aliases (awesome-gh-aliases)

This configuration includes [awesome-gh-aliases](https://github.com/yashbhutwala/awesome-gh-aliases) - useful aliases and API scripts for the GitHub CLI (`gh`).

### Complete GitHub CLI Aliases Reference

**PR Operations**
- `gh pv` = pr view

**Issue Operations**
- `gh bugs` = issue list --label="bugs"
- `gh epicsBy <AUTHOR>` = issue list --author="$1" --label="epic"
- `gh igrep <LABEL> <SEARCH>` = !gh issue list --label="$1" | grep -i $2

**User Information**
- `gh user` = api user (fetch authenticated user info as JSON)

**Advanced GraphQL Queries**

- **`gh list-milestones`** - List open milestones for current repository (with pagination)
  ```bash
  gh list-milestones
  ```
  Output: Tab-separated values of milestone number and title

- **`gh pr-files-changed <PR_NUM>`** - List files changed in a pull request (with pagination)
  ```bash
  gh pr-files-changed 42
  ```
  Output: Tab-separated values of file paths

- **`gh list-repos <USERNAME>`** - List repositories for a specific user (with pagination)
  ```bash
  gh list-repos octocat
  ```
  Output: Tab-separated values of repository names

- **`gh search-repos <COUNT> <QUERY>`** - Search repositories with star counts (with pagination)
  ```bash
  gh search-repos 10 "language:go stars:>1000"
  ```
  Output: Tab-separated values of repository name and star count

### Usage Examples

```bash
# View current PR
gh pv

# List all issues labeled as bugs
gh bugs

# List issues for a specific author with epic label
gh epicsBy octocat

# Search for issues with a specific label
gh igrep "feature-request" "authentication"

# Get authenticated user info
gh user

# List milestones in current repo
gh list-milestones

# See what changed in PR #42
gh pr-files-changed 42

# List all repositories for a user
gh list-repos octocat

# Search for Go repositories with over 1000 stars
gh search-repos 10 "language:go stars:>1000"
```

For implementation details, check [home/gh.nix](home/gh.nix).


## Notes on Network Proxy

If you are in a network environment that requires proxy(such as China), you may need to set up proxy for nix and homebrew.

Please refer to the `rich-demo` folder for more details:

- [rich-demo/scripts/darwin_set_proxy.py](/rich-demo/scripts/darwin_set_proxy.py)
- [rich-demo/Makefile](/rich-demo/Makefile)
- [rich-demo - homebrew's mirror settings](/rich-demo/modules/homebrew-mirror.nix)


